define(["jquery","underscore","backbone","config/config","models/tile","modules/grid","modules/double-spring","modules/grid-dom","modules/trackpad","modules/loader-screen"],function(e,t,n,r,i,s,o,u,f,l){var c,h=n.View.extend({initialize:function(){c=this,IS_IE8=!Modernizr.canvas,IS_IE8,i.dimensions||(i.dimensions=[5,5]);if(mobilecheck()&&(a.width=61.5,a.height=114.5),this.load(),r.mouse){var e=window.innerWidth||document.documentElement.clientWidth,t=window.innerHeight||document.documentElement.clientHeight;r.mouse.x=e/2,r.mouse.y=t/2}},load:function(){loaderScreen=new l,loaderScreen.onComplete=this.kickOff,document.body.appendChild(loaderScreen.view),c.onResize(),e(window).resize(c.onResize)},kickOff:function(){loaded=!0,holding=!0;var t=window.innerWidth||document.documentElement.clientWidth,n=window.innerHeight||document.documentElement.clientHeight;IS_IE8?grid=new u(t,n):(canvas=document.createElement("canvas"),canvas.width=t,canvas.height=n,context=canvas.getContext("2d"),canvas.style.position="absolute",canvas.style.top="0px",canvas.style.left="0px",document.body.appendChild(canvas),canvas.style.display="none",e(canvas).fadeIn("slow"),e(canvas).mousedown(c.onMouseDown),e(canvas).mouseup(c.onMouseUp),e(canvas).mousemove(c.onMouseMove),e(canvas).bind("touchstart",c.onTouchStart),e(canvas).bind("touchend",c.onTouchEnd),e(canvas).bind("touchmove",c.onTouchMove),grid=new s(t,n)),grid.onTransitionFinished=function(){loaderScreen.destroy(),document.body.removeChild(loaderScreen.view)},IS_IE8&&(e(grid.domView).mousedown(onMouseDown),e(grid.domView).mouseup(onMouseUp),e(grid.domView).mousemove(onMouseMove)),trackpad=IS_IE8?new f(grid.domView):new f(canvas),browseMode=!1,pauseGridRender=!1,c.onResize(),resizeCount=19,trackpad.lock();var r=(i.layout.indexOf(0),i.dimensions[0],-2),o=-2;trackpad.setPosition(t/2+250*r+125,n/2+250*o),grid.onStartComplete=c.onGridStartComplete,grid.startIntro(),requestAnimFrame(c.update)},onGridStartComplete:function(){var e,t=window.location.hash,n=t.split("=")[1];if(n)for(var r=0;r<i.content.length;r++)if(n==i.content[r].rfid){e=i.content[r];break}if(e){var s=-2,o=-2;e.positionX=(s+2-.5)*grid.squareWidth+grid.width/2-grid.squareWidth/2+1,e.positionY=(o+1.5-.5)*grid.squareWidth+grid.height/2-grid.squareWidth/2+1}else browseMode=!0,setTimeout(c.unlock,1e3)},unlock:function(){holding=!1,trackpad.unlock()},update:function(){r.isMobile||(resizeCount++,20==resizeCount&&c.realResize()),loaded&&browseMode&&trackpad.update(),r.track&&(r.track.x=trackpad.value,r.track.y=trackpad.valueY),pauseGridRender||(IS_IE8?grid.render():grid.render(context)),requestAnimFrame(c.update)},realResize:function(){console.log("REAL RESIZE");var t=window.innerWidth||document.documentElement.clientWidth,n=window.innerHeight||document.documentElement.clientHeight;if(window.grid){IS_IE8||window.canvas&&(canvas.width=t,canvas.height=n),grid.resize(t,n);var i={x:500,y:500};r.isMobile&&(i.x=t,i.y=n,window.usingForm?t>2*n?e(overlay).fadeIn():e(overlay).fadeOut():t>n?e(overlay).fadeIn():e(overlay).fadeOut());var s=i.x/2,o=i.y/2;pauseGridRender&&(IS_IE8?grid.render():(grid.render(context),viewer.render(context))),t!=this.cacheW&&n!=this.cacheH&&window.scrollTo(0,0),this.cacheW=t,this.cacheH=n,console.log("RESIZING")}},onSwapPressed:function(){window.location.hash="",pauseGridRender=!1,viewer.swap()},onViewerHidden:function(){trackpad.unlock(),grid.unlock(),browseMode=!0},onResize:function(){resizeCount=0;var e=window.innerWidth||document.documentElement.clientWidth,t=window.innerHeight||document.documentElement.clientHeight;this.w=e,this.h=t,mobilecheck()&&(c.realResize(),window.tabMenu&&tabMenu.resize(e,t)),loaderScreen&&loaderScreen.resize(e,t),window.tickerTape&&(tickerTape.view.style.left=e/2-304+"px")},onMouseDown:function(e){},onMouseUp:function(e){},onTouchStart:function(e){e.preventDefault(),r.mouse.x=e.originalEvent.touches[0].clientX+document.body.scrollLeft,r.mouse.y=e.originalEvent.touches[0].clientY+document.body.scrollTop,downTarget.x=r.mouse.x,downTarget.y=r.mouse.y,browseMode&&(grid.firstTouch||(grid.firstTouch=!0),grid.down())},onTouchEnd:function(e){e.preventDefault(),browseMode&&grid.up()},onTouchMove:function(e){if(e.preventDefault(),r.mouse.x=e.originalEvent.touches[0].clientX+document.body.scrollLeft,r.mouse.y=e.originalEvent.touches[0].clientY+document.body.scrollTop,holding){var t=window.innerWidth||document.documentElement.clientWidth,n=window.innerHeight||document.documentElement.clientHeight;r.mouse.x=t/2,r.mouse.y=n/2}testDidMove()},onMouseMove:function(e){},testDidMove:function(){var e=r.mouse.x-r.downTarget.x,t=r.mouse.y-r.downTarget.y,n=e*e+t*t;n>900&&(grid.didMove=!0)}});return h});