define(["jquery","underscore","backbone","collections/images","collections/gallery-slides","views/video-embed","views/outter-tile","views/gallery","match_media","bootstrap_transition","bootstrap_collapse","bootstrap_modal","bootstrap_carousel"],function(e,t,n,r,i,s,o,u,a){var f,l=n.View.extend({el:"body",events:{'change.checkbox.update input[type="checkbox"]':"update_checkbox","change.select.update .selectbox":"update_selectbox",'click.slide [data-slide="toggle"]':"slide_toggle",'click.accordian [data-toggle="collapse"]':"accordian_toggle",'click.display.gallery [data-gallery="toggle"]':"display_gallery"},initialize:function(){f=this;var t=e("html").hasClass("ie9"),n=e("html").hasClass("lt-ie9");f.$content=f.$el.find(".content"),f.$forms=f.$content.find("form"),f.$grids=f.$content.find(".grid"),f.$cols=f.$content.find(".col"),f.outter_columns=[],f.outter_rows=[],f.defaults={max_width:parseInt(f.$content.css("maxWidth"),10),max_height:parseInt(f.$content.css("maxHeight"),10),image_width:16.66667},f.resize_timer,f.update_checkbox(),f.build_selectbox(),f.preload_tiles(f.$el.find(".image-wrap, .ambassador-video-tile")),e.when(r.fetch()).done(function(){f.render_outter_grid()}),e(window).on("resize",f.resize),(t||n)&&e(window).on("load",function(){e(this).trigger("resize")})},update_checkbox:function(t){var n;t?n=e(t.currentTarget):n=f.$forms.find('input[type="checkbox"]'),e.each(n,function(){e(this).parent().find(".tickbox").toggleClass("checked",e(this).is(":checked"))})},resize:function(){console.log("resizing"),f.resizing=!0,clearTimeout(f.resize_timer),f.resize_timer=setTimeout(function(){f.render_outter_grid()},100)},build_selectbox:function(t){f.$forms.find(".selectbox").each(function(){e(this).wrap('<div class="select-wrapper"></div>'),e(this).after('<div class="holder"></div><div class="angle-down-box"><i class="fa fa-angle-down"></i></div>')}),f.update_selectbox()},display_gallery:function(n){var r=e(n.target).data("gallery-id"),s=e(e(n.target).data("gallery-target")),o,a,l=[],c;f.gallery_slides=[],s.data("rendered")||e.when(i.fetch()).done(function(){var e=i.find(function(e){return e.get("id")==r});t.each(e.toJSON().slides,function(e){c=new u({parent:f,slide:e,target:s}),f.gallery_slides.push(c),l.push(c.render().el)}),s.find(".item").after(l).end().carousel("next").data("rendered",!0),t.each(f.gallery_slides,function(e){e.preload_tiles()})})},update_selectbox:function(t){var n;t?n=e(t.currentTarget):n=f.$forms.find(".selectbox"),e.each(n,function(){var t=e(this).next(".holder");this.selectedIndex===0?t.addClass("first-option"):t.removeClass("first-option"),t.text(e(this).find(":selected").text())})},preload_tiles:function(t){a.mobile()||e.each(t,function(t){var n=e(this).find("img");n.css({visibility:"hidden",opacity:0}).on("load",f.stop_loader),f.start_loader(e(this),n)})},start_loader:function(t,n){var r;t.append('<span class="loader"></span>'),r=t.find(".loader");var i=function(t){e({deg:0}).animate({deg:360},{duration:1e3,easing:"linear",step:function(e,t){r.css({transform:"rotate("+e+"deg)"})},complete:function(){n[0].complete||i(360)}})};i(360)},stop_loader:function(t){e(this).siblings(".loader").remove().end().css({visibility:"visible"}).animate({opacity:1},700)},accordian_toggle:function(t){e(t.currentTarget).closest("ul").find("a").removeClass("active"),e(t.currentTarget).addClass("active")},slide_toggle:function(t){var n=e(e(t.currentTarget).data("slide-target")),r;t.preventDefault(),n.hasClass("active")?r={grids:{start_left:"",position:""},cols:{start_left:"-100%",end_left:""}}:r={grids:{start_left:"-100%",position:"static"},cols:{start_left:"100%",end_left:""}},a.tablet()?(n.toggleClass("active inactive"),f.$grids.not(n.find(f.$grids)).fadeToggle({complete:function(){n.css({position:r.grids.position})}})):(f.$grids.not(n.find(f.$grids)).toggleClass("active inactive").each(function(t){e(this).animate({left:r.grids.start_left})}),n.toggleClass("active inactive"))},render_outter_grid:function(){var n=e(window).width(),r=e(window).height(),i,s;a.tablet()?f.$content.css({width:"",height:""}):(t.each([f.outter_columns,f.outter_rows],function(e){t.each(e,function(e){e.remove()})}),n>f.defaults.max_width?f.equalize_columns(n,n-f.defaults.max_width):f.set_outter_grid_defaults("width"),r>f.defaults.max_height?(i=parseInt(f.$el.find(".master-head").height(),10),s=parseInt(f.$el.find(".master-foot").height(),10),f.equalize_rows(r,r-f.defaults.max_height-i-s,i)):f.set_outter_grid_defaults("height"),t.each([f.outter_columns,f.outter_rows],function(e){t.each(e,function(e){e.append_tiles(),e.update_values(),e.preload_tiles()})}))},equalize_columns:function(e,t){f.outter_columns=[],f.set_outter_grid_defaults("width");var n=f.$content.width(),i=f.$content.height(),s=n,u=n/100*f.defaults.image_width,a=Math.ceil(t/u),l=[],c;while(s/100*f.defaults.image_width>=t/a)s--,t++,s=s;f.$content.css({width:s+"px"});for(var h=0;h<a;h++)c=new o({parent:f,collection:r,type:"column",className:"appended-tiles appended-col",styles:{width:(e-s)/a+"px",left:s+s/100*f.defaults.image_width*h+"px"}}),f.outter_columns.push(c),l.push(c.render().el);f.$content.after(l)},equalize_rows:function(e,t,n){f.outter_rows=[],f.set_outter_grid_defaults("height");var i=f.$content.height(),s=f.$content.width(),u=i,a=i/100*50/2,l=Math.ceil(t/a),c=[],h;while(u/100*50/2>=t/l)u--,t++,u=u;f.$content.css({height:u+"px"});for(var p=0;p<l;p++)h=new o({parent:f,collection:r,type:"row",className:"appended-tiles appended-row",styles:{height:u/100*50/2+"px",top:u+n+u/100*50/2*p+"px"}}),f.outter_rows.push(h),c.push(h.render().el);f.$content.after(c)},set_outter_grid_defaults:function(e){var t={};t[e]="",f.$content.css(t)}});return l});