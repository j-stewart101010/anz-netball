define(["jquery","underscore","backbone","views/video-embed","match_media","flippy","polyfiller"],function(e,t,n,r,i){var s,o=n.View.extend({el:"body",events:{'click.video.embed [data-video="toggle"]':"show_video",'click.flip [data-flip="toggle"]':"flip_toggle",'click.enlarge-image [data-enlage="toggle"]':"enlarge_image_toggle"},initialize:function(){s=this,s.$content=s.$el.find(".content"),s.$forms=s.$content.find("form"),e(window).on("resize",s.resize).on("load",s.match_row_height),s.shim_forms()},shim_forms:function(){e.webshims.polyfill("forms"),s.$forms.bind("changedvalid",function(t){e(t.target).parent().addClass("valid").removeClass("invalid")}).bind("changedinvalid",function(t){e(t.target).parent().addClass("invalid").removeClass("valid")}).bind("firstinvalid",function(t){return e.webshims.validityAlert.showFor(t.target),!1})},flip_toggle:function(t){var n=e(t.currentTarget),r=e(n.data("flip-target")),o,u;t.preventDefault(),Modernizr.csstransforms3d?r.toggleClass("flip"):(o=r.find(".front"),u=r.find(".back"),i.tablet()?r.toggleClass("flip"):n.hasClass("btn-action")?o.flippyReverse():o.flippy({color_target:"#c4edf1",verso:u.html(),direction:"LEFT",duration:"750",onFinish:function(){s.$el.updatePolyfill()}}))},enlarge_image_toggle:function(t){var n=e(t.currentTarget),r=e(n.data("enlarge-target")),i=e(n.data("enlarge-to-target"));t.preventDefault(),Modernizr.csstransforms?(r.hasClass("enlarged")?r.css({width:""}).toggle():(r.toggle().css({width:n.width()}),r.css({width:i.width(),height:"auto"})),r.toggleClass("enlarged")):(r.hasClass("enlarged")?r.animate({width:""}):r.animate({width:i.width(),height:"auto"}),r.toggleClass("enlarged"))},scale_enlarged_images:function(){s.$el.find(".enlarged").width(e(window).width())},show_video:function(t){var n=new r({modal:!1,video_id:e(t.target).data("video-id")});s.$content.find(e(t.target).data("video-append")).append(n.render().el),this.delegateEvents()},resize:function(){s.match_row_height(),s.scale_enlarged_images()},match_row_height:function(){i.tablet()?e.each(s.$content.find("[data-resize-height]"),function(){e(this).css({height:""}).css({height:e(e(this).data("resize-height")).height()+"px"})}):e.each(s.$content.find("[data-resize-height]"),function(){e(this).css({height:""})})}});return o});